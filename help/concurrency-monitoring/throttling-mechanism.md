---
title: スロットルメカニズム
description: スロットルメカニズム
source-git-commit: cbb45cae576332e2b63027992c597b834210988d
workflow-type: tm+mt
source-wordcount: '624'
ht-degree: 1%

---


# スロットルメカニズム {#throttling-mechanism}

## 概要 {#introduction}

Adobeは、お客様のデータ処理者としての役割を果たし、お客様のユーザーがリソースを公平に使用し、サービスが不要な API リクエストであふれるのを防ぐために、適切な対策を講じる必要があります。 そのために、スロットルメカニズムを導入しました。
1 つの同時実行監視アプリケーションは、複数のユーザーが使用でき、1 人のユーザーが複数のセッションを持つことができます。 したがって、サービスには、特定の期間内のユーザー/セッションごとの許可された呼び出し数に対して設定された制限があります。
制限に達すると、リクエストには特定の応答ステータス (HTTP 429 Too Many Requests) が表示されます。 「429 Too Many Requests」の応答の後におこなわれる以降の呼び出しは、少なくとも 1 分間のクールダウン期間で実行し、有効なビジネス応答を取得する必要があります。

## メカニズムの概要 {#mechanism-overview}

このメカニズムは、特定の期間内の、各同時実行監視エンドポイントに対して許可された呼び出しの最大数を決定します。
この最大呼び出し数に達すると、アドビのサービスは「429 Too many requests」で応答します。 429 応答の「Expires」ヘッダーには、次の呼び出しが有効と見なされる時点、またはスロットルの有効期限が切れた時点のタイムスタンプが含まれます。 現在、スロットルは最初の 429 応答から 1 分後に期限切れになります。

スロットリングを設定したエンドポイントは次のとおりです。
1. 新しいセッションを作成します。POST/sessions/{idp}/{subject}
2. ハートビート呼び出し：POST/sessions/{idp}/{subject}/{sessionId}
3. セッションを終了：DELETE/sessions/{idp}/{subject}/{sessionId}

スロットルは次の 2 つのレベルで設定します。
1. セッション：同じ一意 {sessionId} 送信されたパラメーター `Heartbeat` を呼び出し、 `Terminate a session` を呼び出します。
2. ユーザー：同じ一意 {subject} 送信されたパラメーター `Create a new session` を呼び出します。

セッションレベルのスロットルの制限は、1 分以内に 200 件のリクエストに設定されます。\
ユーザーレベルのスロットルの制限は、1 分以内に 200 件のリクエストに設定されます。\
これらの制限（セッションレベルのスロットルとユーザーレベルのスロットル）はどちらも設定可能です。有効な統合シナリオで達する場合に備えて、これらの制限を更新します。 そのためには、サポートチームに連絡することをお勧めします。

**セッションレベルのスロットルのシナリオ：**

| 時間 | CM に送信するリクエスト | リクエスト数 | CM から応答を受信しました | 説明 |
|-----------|-----------------------------------------|--------------------|------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| 2 番目の 10 | POST/sessions/idp1/subject1/session1 | 50 | すべての呼び出しが「202 許可済み」を受け取ります | 上限から 50 件の呼び出しが消費されました |
| 第 250 | POST/sessions/idp1/subject1/session1 | 151 | 150 の呼び出しが「202 Accepted」を受け取り、1 の呼び出しが「429 Too many requests」を受け取る | 上限から消費された 200 件の呼び出しと 1 件の呼び出しが 429 応答を受け取ります |
| 2 番目の 61 | DELETE/sessions/idp1/subject1/session1 | 1 | 1 件の呼び出しが「429 Too many requests」を受け取る | 使用可能な制限内に呼び出しがまだありません |
| 2 番目の 70 | DELETE/sessions/idp1/subject1/session1 | 1 | 1 件の呼び出しが「202 受理」を受信 | 2 番目の 10 から 60 秒が経過したので、使用可能な呼び出しに対して 200 に制限が設定される |

**ユーザーレベルのスロットルのシナリオ：**

| 時間 | CM に送信するリクエスト | リクエスト数 | CM から応答を受信しました | 説明 |
|-----------|------------------------------|--------------------|------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| 2 番目の 10 | POST/sessions/idp1/subject1 | 50 | 50 回の呼び出しが「202 Accepted」を受け取る | 上限から 50 件の呼び出しが消費されました |
| 第 250 | POST/sessions/idp1/subject1 | 151 | 150 の呼び出しが「202 Accepted」を受け取り、1 の呼び出しが「429 Too many requests」を受け取る | 上限から消費された 200 件の呼び出しと 1 件の呼び出しが 429 応答を受け取ります |
| 2 番目の 61 | POST/sessions/idp1/subject1 | 1 | 1 件の呼び出しが「429 Too many requests」を受け取る | 使用可能な制限内に呼び出しがまだありません |
| 2 番目の 70 | POST/sessions/idp1/subject1 | 1 | 1 件の呼び出しが「202 受理」を受信 | 2 番目の 10 から 60 秒が経過したので、使用可能な呼び出しに対して 200 に制限が設定される |

**429 応答の例：**

```
HTTP/2 429
date: Thu, 15 Feb 2024 07:54:20 GMT
content-length: 0
vary: Origin
vary: Access-Control-Request-Method
vary: Access-Control-Request-Headers
cache-control: no-store
expires: Thu, 15 Feb 2024 07:54:41 GMT
strict-transport-security: max-age=31536000 ; includeSubDomains
x-xss-protection: 1; mode=block
x-frame-options: DENY
x-content-type-options: nosniff
```

## 顧客統合に関する推奨事項 {#customer-integration-recommendations}

正しい実装では、「429 Too Many Requests」応答を受け取りません。
それでも、Adobeでは、各顧客が上記の技術的な詳細を使用して「429 Too Many Requests」の応答を適切に処理することを推奨します。 応答を処理する際は、次に有効なリクエストを送信するタイミングを決定するために、「期限切れ」ヘッダーを使用する必要があります。
