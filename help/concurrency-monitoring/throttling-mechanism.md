---
title: スロットルメカニズム
description: スロットルメカニズム
exl-id: 15236570-1a75-42fb-9bba-0e2d7a59c9f6
source-git-commit: 8552a62f4d6d80ba91543390bf0689d942b3a6f4
workflow-type: tm+mt
source-wordcount: '624'
ht-degree: 1%

---

# スロットルメカニズム {#throttling-mechanism}

## 概要 {#introduction}

Adobeは、お客様のデータ処理者としての役割を果たすために、お客様の利用者が資源を公平に利用し、サービスに不要な API リクエストが溢れないように適切な対策を講じる必要があります。 このため、スロットルメカニズムを導入しました。
1 つの同時実行監視アプリケーションを複数のユーザーが使用でき、1 人のユーザーが複数のセッションを持つことができます。 したがって、このサービスには、特定の期間内のユーザー/セッションごとの受け入れ可能な呼び出し数に対する制限が設定されます。
制限に達すると、リクエストは特定の応答ステータス（HTTP 429 Too Many Requests）でマークされます。 「429 リクエストが多すぎます」応答を受け取った後に行う後続の呼び出しでは、有効なビジネス応答を取得できるように、少なくとも 1 分のクールダウン期間を付けて実行する必要があります。

## メカニズムの概要 {#mechanism-overview}

このメカニズムは、特定の期間内の各同時実行監視エンドポイントに対する受け入れ可能な呼び出しの最大数を決定します。
この最大呼び出し数に達すると、サービスは「429 Too many requests」で応答します。 429 応答「Expires」ヘッダーには、次回の呼び出しが有効と見なされるタイムスタンプまたはスロットルの有効期限が含まれます。 現在、スロットルは 1 回後に期限切れになります   最初の 429 応答からの分。

スロットルが設定されたエンドポイントは次のとおりです。
1. 新しいセッションを作成します：POST /sessions/{idp}/{subject}
2. ハートビート呼び出し：POST /sessions/{idp}/{subject}/{sessionId}
3. セッションの終了：DELETE /sessions/{idp}/{subject}/{sessionId}

スロットルは、次の 2 つのレベルで設定されます。
1. セッション：呼び出しと `Terminate a session` 呼び出しで送信され `Heartbeat` 一意の同じ {sessionId} パラメーター。
2. ユーザー：呼び出しで送信された一意の {subject} パラメーター `Create a new session` 同じです。

セッションレベルのスロットルの制限は、1 分以内に 200 リクエストに設定されます。\
ユーザーレベルのスロットリングの制限は、1 分以内に 200 件のリクエストに設定されます。\
これらの制限（セッションレベルのスロットリングとユーザーレベルのスロットリング）は両方とも設定可能で、有効な統合シナリオで到達した場合に備えて更新します。 このため、サポートチームに連絡することをお勧めします。

**セッションレベルのスロットルのシナリオ：**

| 時間 | CM に送信するリクエスト | リクエスト数 | CM から受信した応答 | 説明 |
|-----------|-----------------------------------------|--------------------|------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| 第 10 | POST /sessions/idp1/subject1/session1 | 50 | すべての呼び出しが「202 Accepted」を受け取る | 制限から 50 件の呼び出しが消費されました |
| 50 秒 | POST /sessions/idp1/subject1/session1 | 151 | 150 件の呼び出しが「202 Accepted」、1 件の呼び出しが「429 Too many requests」を受け取ります | 制限から 200 件の呼び出しが消費され、1 件の呼び出しが 429 応答を受信します |
| 第 61 回 | DELETE /sessions/idp1/subject1/session1 | 1 | 1 回の呼び出しで「429 Too many requests」を受信 | 制限内の呼び出しはまだ使用できません |
| 70 秒目 | DELETE /sessions/idp1/subject1/session1 | 1 | 1 件の呼び出しが「202 Accepted」を受信 | 10 秒目から 60 秒が経過したので、使用可能な呼び出し 200 件に設定された制限 |

**ユーザーレベルのスロットルのシナリオ：**

| 時間 | CM に送信するリクエスト | リクエスト数 | CM から受信した応答 | 説明 |
|-----------|------------------------------|--------------------|------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| 第 10 | POST /sessions/idp1/subject1 | 50 | 50 件の呼び出しが「202 Accepted」と受信される | 制限から 50 件の呼び出しが消費されました |
| 50 秒 | POST /sessions/idp1/subject1 | 151 | 150 件の呼び出しが「202 Accepted」、1 件の呼び出しが「429 Too many requests」を受け取ります | 制限から 200 件の呼び出しが消費され、1 件の呼び出しが 429 応答を受信します |
| 第 61 回 | POST /sessions/idp1/subject1 | 1 | 1 回の呼び出しで「429 Too many requests」を受信 | 制限内の呼び出しはまだ使用できません |
| 70 秒目 | POST /sessions/idp1/subject1 | 1 | 1 件の呼び出しが「202 Accepted」を受信 | 10 秒目から 60 秒が経過したので、使用可能な呼び出し 200 件に設定された制限 |

**429 応答の例：**

```
HTTP/2 429
date: Thu, 15 Feb 2024 07:54:20 GMT
content-length: 0
vary: Origin
vary: Access-Control-Request-Method
vary: Access-Control-Request-Headers
cache-control: no-store
expires: Thu, 15 Feb 2024 07:54:41 GMT
strict-transport-security: max-age=31536000 ; includeSubDomains
x-xss-protection: 1; mode=block
x-frame-options: DENY
x-content-type-options: nosniff
```

## 顧客統合に関する推奨事項 {#customer-integration-recommendations}

正しく実装すると、お客様には「429 Too Many Requests」という応答は届きません。
それでもAdobeでは、上記の技術的な詳細を使用して、各顧客が「429 リクエストが多すぎます」という応答を適切に処理することをお勧めします。 応答を処理する際には、次の有効なリクエストを送信するタイミングを決定するために、「Expires」ヘッダーを使用する必要があります。
